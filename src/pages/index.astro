---
import BaseLayout from "../layouts/BaseLayout.astro";

// Import Section Components
import Hero from "../components/sections/Hero.astro";
import Problem from "../components/sections/Problem.astro";
import Solution from "../components/sections/Solution.astro";
import USP from "../components/sections/USP.astro";
import CaseStudies from "../components/sections/CaseStudies.astro";
import Testimonials from "../components/sections/Testimonials.astro";
import PotenzialRechner from "../components/sections/PotenzialRechner.astro";
import Process from "../components/sections/Process.astro";
import CTASection from "../components/sections/CTASection.astro";
import ContactForm from "../components/sections/ContactForm.astro";
import FAQ from "../components/sections/FAQ.astro";

const base = import.meta.env.BASE_URL;
---

<BaseLayout
    title="Decari – Mehr Umsatz mit bestehenden Klienten | Sozialleistungs-Service für Pflegedienste"
    description="Decari beantragt für Ihre Klienten zusätzliche Sozialleistungen. Bis zu +3.000€/Monat pro Klient mit Zusatzanspruch – für effizientere Teams."
    canonicalUrl="https://partner.decari.de/"
>
    <!-- Page Sections -->
    <Hero />
    <Problem />
    <Solution />
    <USP />
    <CaseStudies />
    <Testimonials />
    <PotenzialRechner />
    <Process />
    <CTASection />
    <ContactForm />
    <FAQ />

    <!-- Potenzialrechner Script -->
    <script is:inline src={`${base}js/potenzialrechner.js`}></script>

    <!-- Contact Form AJAX Submit -->
    <script is:inline>
        const form = document.getElementById("contact-form");
        const submitBtn = document.getElementById("submit-btn");
        const formSuccess = document.getElementById("form-success");
        const formError = document.getElementById("form-error");

        form?.addEventListener("submit", async function (e) {
            e.preventDefault();

            formError?.classList.add("hidden");

            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML =
                    '<svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
            }

            const formData = new FormData(form);

            try {
                const response = await fetch(
                    "https://api.web3forms.com/submit",
                    {
                        method: "POST",
                        body: formData,
                    },
                );

                const data = await response.json();

                if (data.success) {
                    form.classList.add("hidden");
                    formSuccess?.classList.remove("hidden");
                } else {
                    throw new Error("Form submission failed");
                }
            } catch (error) {
                formError?.classList.remove("hidden");
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = "Nachricht senden";
                }
            }
        });
    </script>
</BaseLayout>
