---
import BaseLayout from '../layouts/BaseLayout.astro';

// Import main content as raw string using Vite's ?raw suffix
import mainContent from '../content/main-content.html?raw';
---

<BaseLayout
  title="Decari – Mehr Umsatz mit bestehenden Klienten | Sozialleistungs-Service für Pflegedienste"
  description="Decari beantragt für Ihre Klienten zusätzliche Sozialleistungen. Bis zu +3.000€/Monat pro Klient mit Zusatzanspruch – ohne zusätzliches Personal."
  canonicalUrl="https://pflegedienste.decari.de/"
>
  <Fragment set:html={mainContent} />

  <!-- Sticky Mobile CTA -->
  <div
    class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3 md:hidden z-50 shadow-lg"
    id="mobile-cta"
  >
    <button
      id="mobile-cta-btn"
      class="w-full bg-teal text-white py-3 rounded-lg font-semibold shadow-md active:bg-teal-light"
    >
      Jetzt Termin buchen
    </button>
  </div>

  <!-- ROI Calculator Script -->
  <script is:inline src="/js/roi-calculator.js"></script>

  <!-- Mobile CTA Calendly -->
  <script is:inline>
    document.getElementById('mobile-cta-btn')?.addEventListener('click', () => {
      if (typeof Calendly !== 'undefined') {
        Calendly.initPopupWidget({
          url: 'https://calendly.com/steffen-decari/erstgespraech?primary_color=097788'
        });
      }
    });
  </script>

  <!-- Contact Form AJAX Submit -->
  <script is:inline>
    const form = document.getElementById("contact-form");
    const submitBtn = document.getElementById("submit-btn");
    const formSuccess = document.getElementById("form-success");
    const formError = document.getElementById("form-error");

    form?.addEventListener("submit", async function (e) {
      e.preventDefault();

      formError?.classList.add("hidden");

      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
      }

      const formData = new FormData(form);

      try {
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        if (data.success) {
          form.classList.add("hidden");
          formSuccess?.classList.remove("hidden");
        } else {
          throw new Error("Form submission failed");
        }
      } catch (error) {
        formError?.classList.remove("hidden");
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = "Nachricht senden";
        }
      }
    });
  </script>
</BaseLayout>
