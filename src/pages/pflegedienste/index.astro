---
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import StateCard from "../../components/pflegedienste/StateCard.astro";
import CityCard from "../../components/pflegedienste/CityCard.astro";
import DirectoryCTA from "../../components/pflegedienste/DirectoryCTA.astro";
import "../../styles/global.css";
import { bundeslaender, staedte, pflegedienste } from "../../data/pflegedienste";
import { formatCurrency } from "../../utils/potentialCalculator";

// Get top cities by dienste count
const topCities = staedte.slice(0, 20);

// Calculate total potential
const totalDienste = pflegedienste.length;
const avgMonthlyPerDienst = 1654; // ~7 eligible clients * 350€ * 0.67
const totalYearlyPotential = totalDienste * avgMonthlyPerDienst * 12;

const siteUrl = "https://partner.decari.de";
const canonicalUrl = `${siteUrl}/pflegedienste/`;

const metaDescription = `Verzeichnis aller ${totalDienste.toLocaleString('de-DE')} ambulanten Pflegedienste in Deutschland. Finden Sie Pflegedienste in Ihrer Nähe mit Kontaktdaten und Informationen.`;

// JSON-LD BreadcrumbList
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Startseite", "item": siteUrl },
    { "@type": "ListItem", "position": 2, "name": "Pflegedienste" }
  ]
};

// JSON-LD WebPage
const webPageSchema = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Pflegedienste in Deutschland",
  "description": metaDescription,
  "url": canonicalUrl,
  "isPartOf": {
    "@type": "WebSite",
    "name": "Decari",
    "url": siteUrl
  }
};
---

<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pflegedienste in Deutschland | {totalDienste.toLocaleString('de-DE')} Anbieter – Decari</title>
    <meta name="description" content={metaDescription} />

    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:type" content="website" />
    <meta property="og:title" content={`Pflegedienste in Deutschland – ${totalDienste.toLocaleString('de-DE')} Anbieter`} />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:image" content={`${siteUrl}/assets/decari-og-image.png`} />

    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(webPageSchema)} />

    <link rel="icon" type="image/png" href="/assets/decari-favicon.png" />
    <link rel="apple-touch-icon" href="/assets/decari-favicon.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link
      rel="preload"
      href="https://assets.calendly.com/assets/external/widget.css"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css" />
    </noscript>
  </head>
  <body class="font-sans text-gray-800 bg-gray-50 antialiased">
    <Header variant="blog-index" />

    <main class="py-8 md:py-12">
      <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-500 mb-6" aria-label="Breadcrumb">
          <ol class="flex items-center gap-2">
            <li>
              <a href="/" class="hover:text-teal transition-colors">Startseite</a>
            </li>
            <li class="text-gray-400">/</li>
            <li class="text-gray-700 font-medium">Pflegedienste</li>
          </ol>
        </nav>

        <!-- Hero Section -->
        <header class="text-center mb-12">
          <h1 class="text-3xl md:text-5xl font-bold text-navy mb-4">
            Pflegedienste in Deutschland
          </h1>
          <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto">
            Das umfassende Verzeichnis aller ambulanten Pflegedienste mit Kontaktdaten und Informationen.
          </p>

          <!-- Stats -->
          <div class="flex flex-wrap justify-center gap-8 mt-8">
            <div class="text-center">
              <p class="text-3xl md:text-4xl font-bold text-teal">
                {totalDienste.toLocaleString('de-DE')}
              </p>
              <p class="text-sm text-gray-500">Pflegedienste</p>
            </div>
            <div class="text-center">
              <p class="text-3xl md:text-4xl font-bold text-navy">
                {bundeslaender.length}
              </p>
              <p class="text-sm text-gray-500">Bundesländer</p>
            </div>
            <div class="text-center">
              <p class="text-3xl md:text-4xl font-bold text-navy">
                {staedte.length.toLocaleString('de-DE')}
              </p>
              <p class="text-sm text-gray-500">Städte</p>
            </div>
          </div>
        </header>

        <!-- Potential Highlight -->
        <section class="bg-gradient-to-br from-navy to-navy/90 rounded-2xl p-6 md:p-10 text-white mb-12">
          <div class="flex flex-col md:flex-row md:items-center gap-6">
            <div class="flex-1">
              <h2 class="text-2xl md:text-3xl font-bold mb-3">
                Ungenutztes Potenzial deutschlandweit
              </h2>
              <p class="text-white/80 text-lg">
                Jedes Jahr werden schätzungsweise <span class="font-bold text-white">{formatCurrency(totalYearlyPotential)}</span> an Sozialleistungen für Pflegebedürftige nicht abgerufen.
              </p>
            </div>
            <div class="flex-shrink-0">
              <a
                href="/#rechner"
                class="inline-flex items-center justify-center px-6 py-3 bg-teal text-white font-semibold rounded-lg hover:bg-teal-light transition-colors"
              >
                Ihr Potenzial berechnen
              </a>
            </div>
          </div>
        </section>

        <!-- Bundesländer -->
        <section class="mb-12">
          <h2 class="text-2xl font-bold text-navy mb-6">
            Pflegedienste nach Bundesland
          </h2>
          <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            {bundeslaender.map((bl) => (
              <StateCard bundesland={bl} />
            ))}
          </div>
        </section>

        <!-- Top Cities -->
        <section class="mb-12">
          <h2 class="text-2xl font-bold text-navy mb-2">
            Top-Städte nach Anzahl Pflegedienste
          </h2>
          <p class="text-gray-600 mb-6">
            Die 20 Städte mit den meisten ambulanten Pflegediensten
          </p>
          <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
            {topCities.map((stadt) => (
              <CityCard stadt={stadt} />
            ))}
          </div>
        </section>

        <!-- CTA -->
        <DirectoryCTA
          title="Sind Sie Pflegedienstleitung?"
          description="Erfahren Sie, wie Decari Ihnen hilft, ungenutztes Umsatzpotenzial bei Ihren Klienten zu erschließen – ohne Mehraufwand für Ihr Team."
        />

        <!-- SEO Text -->
        <section class="mt-12 prose prose-lg max-w-none">
          <h2 class="text-xl font-bold text-navy">Über dieses Verzeichnis</h2>
          <p class="text-gray-600">
            Unser Verzeichnis umfasst {totalDienste.toLocaleString('de-DE')} ambulante Pflegedienste
            in allen {bundeslaender.length} Bundesländern Deutschlands. Hier finden Sie Kontaktdaten,
            Adressen und weitere Informationen zu Pflegediensten in Ihrer Nähe.
          </p>
          <p class="text-gray-600">
            Als Pflegedienst möchten wir Sie darauf aufmerksam machen, dass viele Ihrer Klienten
            Anspruch auf zusätzliche Sozialleistungen haben könnten, die bisher nicht abgerufen werden.
            Decari unterstützt Sie dabei, dieses Potenzial zu erschließen – vollständig ohne Mehraufwand
            für Ihr Team.
          </p>
        </section>
      </div>
    </main>

    <Footer />

    <script is:inline>
      let calendlyLoaded = false;
      function loadCalendly() {
        if (calendlyLoaded) return;
        calendlyLoaded = true;
        const script = document.createElement("script");
        script.src = "https://assets.calendly.com/assets/external/widget.js";
        script.async = true;
        document.body.appendChild(script);
      }

      ["scroll", "mousemove", "touchstart", "click"].forEach((event) => {
        document.addEventListener(event, loadCalendly, { once: true, passive: true });
      });

      setTimeout(loadCalendly, 2000);

      window.openCalendlyPopup = (function () {
        let isOpening = false;
        return function () {
          if (isOpening || typeof Calendly === "undefined") return;
          isOpening = true;
          Calendly.initPopupWidget({
            url: "https://calendly.com/steffen-decari/erstgespraech?primary_color=097788",
          });
          setTimeout(function () { isOpening = false; }, 1000);
        };
      })();
    </script>
  </body>
</html>
