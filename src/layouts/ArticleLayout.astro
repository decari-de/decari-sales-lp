---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Disclaimer from "../components/Disclaimer.astro";
import "../styles/global.css";

interface Props {
    title: string;
    description: string;
    category: string;
    breadcrumbTitle: string;
    slug: string;
    publishedDate: string;
    modifiedDate?: string;
    ogImage?: string;
}

const {
    title,
    description,
    category,
    breadcrumbTitle,
    slug,
    publishedDate,
    modifiedDate,
    ogImage,
} = Astro.props;
const siteUrl = "https://partner.decari.de";
const canonicalUrl = `${siteUrl}/ratgeber/${slug}/`;
const imageUrl = ogImage || `${siteUrl}/assets/decari-og-image.png`;

// JSON-LD Schemas
const articleSchema = {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: title,
    description: description,
    datePublished: publishedDate,
    dateModified: modifiedDate || publishedDate,
    author: { "@type": "Organization", name: "Decari GmbH" },
    publisher: {
        "@type": "Organization",
        name: "Decari GmbH",
        logo: {
            "@type": "ImageObject",
            url: `${siteUrl}/assets/decari-logo.png`,
        },
    },
    mainEntityOfPage: { "@type": "WebPage", "@id": canonicalUrl },
};

const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        { "@type": "ListItem", position: 1, name: "Startseite", item: siteUrl },
        {
            "@type": "ListItem",
            position: 2,
            name: "Ratgeber",
            item: `${siteUrl}/ratgeber/`,
        },
        { "@type": "ListItem", position: 3, name: breadcrumbTitle },
    ],
};
---

<!doctype html>
<html lang="de">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{title} – Decari Ratgeber</title>
        <meta name="description" content={description} />

        <!-- Canonical URL -->
        <link rel="canonical" href={canonicalUrl} />

        <!-- Open Graph -->
        <meta property="og:type" content="article" />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:url" content={canonicalUrl} />
        <meta property="og:image" content={imageUrl} />
        <meta property="og:locale" content="de_DE" />

        <!-- Article-specific meta tags -->
        <meta property="article:published_time" content={publishedDate} />
        {
            modifiedDate && (
                <meta property="article:modified_time" content={modifiedDate} />
            )
        }
        <meta property="article:author" content="Decari Team" />

        <!-- JSON-LD Structured Data -->
        <script
            type="application/ld+json"
            set:html={JSON.stringify(articleSchema)}
        />
        <script
            type="application/ld+json"
            set:html={JSON.stringify(breadcrumbSchema)}
        />

        <!-- Favicon -->
        <link rel="icon" type="image/png" href="/assets/decari-favicon.png" />
        <link rel="apple-touch-icon" href="/assets/decari-favicon.png" />

        <!-- Preconnect -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <!-- Fonts -->
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- Calendly CSS -->
        <link
            rel="preload"
            href="https://assets.calendly.com/assets/external/widget.css"
            as="style"
            onload="this.onload=null;this.rel='stylesheet'"
        />
        <noscript>
            <link
                rel="stylesheet"
                href="https://assets.calendly.com/assets/external/widget.css"
            />
        </noscript>
    </head>
    <body class="font-sans text-gray-800 bg-white antialiased">
        <Header />

        <article class="py-12 md:py-16">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Breadcrumb -->
                <nav class="text-sm text-gray-500 mb-6">
                    <a href="/" class="hover:text-teal">Startseite</a>
                    <span class="mx-2">/</span>
                    <a href="/ratgeber/" class="hover:text-teal">Ratgeber</a>
                    <span class="mx-2">/</span>
                    <span class="text-gray-700">{breadcrumbTitle}</span>
                </nav>

                <!-- Article Header -->
                <header class="mb-10">
                    <div
                        class="text-xs text-teal font-semibold uppercase tracking-wide mb-3"
                    >
                        {category}
                    </div>
                    <h1 class="text-3xl md:text-4xl font-bold text-navy mb-4">
                        {title}
                    </h1>
                    <p class="text-lg text-gray-600">
                        {description}
                    </p>
                </header>

                <!-- Article Content -->
                <div class="prose prose-lg max-w-none">
                    <slot />
                </div>

                <!-- Legal Disclaimer -->
                <Disclaimer />

                <!-- CTA Section -->
                <div
                    class="mt-16 bg-teal/10 border-l-4 border-teal p-8 rounded-r-xl"
                >
                    <h3 class="text-xl font-bold text-navy mb-3">
                        Möchten Sie das Potenzial Ihrer Klienten nutzen?
                    </h3>
                    <p class="text-gray-600 mb-6">
                        Decari übernimmt die komplette Antragstellung für Ihre
                        Klienten. Berechnen Sie jetzt, wie viel Umsatz auf dem
                        Tisch liegt.
                    </p>
                    <a
                        href="/#rechner"
                        class="inline-flex bg-teal text-white font-semibold px-6 py-3 rounded-lg hover:bg-teal-light transition-all"
                    >
                        Zum Potenzialrechner
                    </a>
                </div>

                <!-- Back to Ratgeber -->
                <div class="mt-12 pt-8 border-t border-gray-200">
                    <a
                        href="/ratgeber/"
                        class="text-teal font-medium hover:underline"
                    >
                        &larr; Zurück zum Ratgeber
                    </a>
                </div>
            </div>
        </article>

        <Footer />

        <!-- Calendly Widget - lazy loaded -->
        <script is:inline>
            let calendlyLoaded = false;
            function loadCalendly() {
                if (calendlyLoaded) return;
                calendlyLoaded = true;
                const script = document.createElement("script");
                script.src =
                    "https://assets.calendly.com/assets/external/widget.js";
                script.async = true;
                document.body.appendChild(script);
            }

            ["scroll", "mousemove", "touchstart", "click"].forEach((event) => {
                document.addEventListener(event, loadCalendly, {
                    once: true,
                    passive: true,
                });
            });

            setTimeout(loadCalendly, 3000);
        </script>
    </body>
</html>
