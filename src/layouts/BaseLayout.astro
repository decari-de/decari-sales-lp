---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  canonicalUrl?: string;
  ogImage?: string;
}

const {
  title,
  description = "Decari beantragt für Ihre Klienten zusätzliche Sozialleistungen. Bis zu +3.000€/Monat pro Klient mit Zusatzanspruch – ohne zusätzliches Personal.",
  canonicalUrl,
  ogImage = "/assets/decari-logo.png"
} = Astro.props;

const siteUrl = "https://partner.decari.de";
const base = import.meta.env.BASE_URL;
---

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <meta name="description" content={description} />

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={canonicalUrl || siteUrl} />
  <meta property="og:locale" content="de_DE" />
  <meta property="og:image" content={`${siteUrl}${ogImage}`} />

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={`${siteUrl}${ogImage}`} />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href={`${base}assets/decari-favicon.png`} />
  <link rel="apple-touch-icon" href={`${base}assets/decari-favicon.png`} />

  <!-- Canonical -->
  {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}

  <!-- Preconnect for Performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- Preload critical font -->
  <link
    rel="preload"
    href="https://fonts.gstatic.com/s/inter/v20/UcC73FwrK3iLTeHuS_nVMrMxCp50SjIa1ZL7W0Q5nw.woff2"
    as="font"
    type="font/woff2"
    crossorigin
  />

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Calendly CSS - loaded async -->
  <link
    rel="preload"
    href="https://assets.calendly.com/assets/external/widget.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript>
    <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css" />
  </noscript>

  <!-- Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ProfessionalService",
    "name": "Decari GmbH",
    "description": "Sozialleistungs-Service für Pflegedienste. Wir beantragen zusätzliche Sozialleistungen für Ihre Klienten.",
    "url": "https://www.decari.de",
    "email": "steffen@decari.de",
    "serviceType": "Sozialleistungs-Service",
    "areaServed": "DE"
  })} />
</head>
<body class="font-sans text-gray-800 bg-white antialiased">
  <!-- Skip to Content (Accessibility) -->
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-teal text-white px-4 py-2 rounded-lg z-50"
  >
    Zum Hauptinhalt springen
  </a>

  <Header />

  <main id="main-content">
    <slot />
  </main>

  <Footer />

  <!-- Cookie Banner -->
  <div
    id="cookie-banner"
    class="hidden"
    style="position: fixed; bottom: 16px; right: 16px; z-index: 9999; width: 390px; max-width: calc(100vw - 32px);"
  >
    <div
      class="bg-white rounded-lg border border-gray-200 relative"
      style="box-shadow: 0 10px 38px -10px rgba(22, 23, 24, 0.35), 0 10px 20px -15px rgba(22, 23, 24, 0.2); padding: 16px 20px 20px 20px;"
    >
      <!-- Header with Title and Close Button -->
      <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 12px;">
        <h3 style="font-size: 15px; font-weight: 600; color: #111827; line-height: 1.4; margin: 0;">
          Gesetzlich vorgeschriebener Cookie-Banner
        </h3>
        <button
          onclick="closeCookieBanner()"
          style="color: #9ca3af; background: none; border: none; cursor: pointer; padding: 0; flex-shrink: 0;"
          aria-label="Schließen"
        >
          <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.75 3.69 12 10.94l7.25-7.25 1.06 1.06L13.06 12l7.25 7.25-1.06 1.06L12 13.06l-7.25 7.25-1.06-1.06L10.94 12 3.69 4.75l1.06-1.06Z" />
          </svg>
        </button>
      </div>

      <!-- Content -->
      <p style="font-size: 14px; color: #4b5563; line-height: 1.6; margin: 0 0 12px 0;">
        Wir verwenden keine Third-Party-Cookies, nur einen einzigen First-Party-Cookie.
      </p>
      <p style="font-size: 14px; color: #4b5563; line-height: 1.6; margin: 0; padding-right: 120px;">
        Keine Daten gehen an Dritte.<br />
        (<span style="border-bottom: 1px dashed #9ca3af">Ursula von der Leyen</span> wäre stolz.)
      </p>

      <!-- Ursula Image -->
      <img
        src={`${base}assets/ursula.png`}
        alt="Ursula von der Leyen"
        style="position: absolute; bottom: 12px; right: 12px; width: 100px; height: auto; pointer-events: none;"
      />
    </div>
  </div>

  <!-- Cookie Banner Script -->
  <script is:inline>
    function closeCookieBanner() {
      document.getElementById("cookie-banner").classList.add("hidden");
      localStorage.setItem("cookieBannerDismissed", "true");
    }

    function showCookieBanner() {
      if (!localStorage.getItem("cookieBannerDismissed")) {
        setTimeout(() => {
          document.getElementById("cookie-banner").classList.remove("hidden");
        }, 2000);
      }
    }

    showCookieBanner();
  </script>

  <!-- Calendly Widget - lazy loaded -->
  <script is:inline>
    let calendlyLoaded = false;
    function loadCalendly() {
      if (calendlyLoaded) return;
      calendlyLoaded = true;
      const script = document.createElement("script");
      script.src = "https://assets.calendly.com/assets/external/widget.js";
      script.async = true;
      document.body.appendChild(script);
    }

    ["scroll", "mousemove", "touchstart", "click"].forEach((event) => {
      document.addEventListener(event, loadCalendly, { once: true, passive: true });
    });

    setTimeout(loadCalendly, 1500);
  </script>
</body>
</html>
